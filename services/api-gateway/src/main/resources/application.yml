spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      server:
        webmvc:
          routes:
            - id: challenge-route
              uri: lb://challenge-manager/
              predicates:
                - Path=/challenges/random, /attempts

            - id: user-manager-route
              uri: lb://user-manager/
              predicates:
                - Path=/auth/**, /users/**
              strip-prefix: 0

            - id: gamification-manager-route
              uri: lb://gamification-manager/
              predicates:
                - Path=/leaders/**

            - id: notification-manager-route
              uri: lb://notification-manager/
              predicates:
                - Path=/notifications/**

            - id: analytics-manager-route/
              uri: lb://analytics-manager
              predicates:
                - Path=/analytics/attempts/**, /analytics/statistics/**
    consul:
      enabled: true
      host: ${CONSUL_HOST:consul}
      port: 8500
      discovery:
        service-name: ${spring.application.name}
        health-check-path: /health
        health-check-interval: 15s
        scheme: http
        port: ${management.server.port}
        query-passing: true
    default-filters:
      - name: Retry
        args:
          retries: 3
          methods: GET, POST

server:
  port: ${SERVICE_PORT:8080}

management:
  server:
    port: ${MANAGEMENT_PORT:9090}
  endpoints:
    web:
      exposure:
        include: health, info, prometheus
      base-path: /
  endpoint:
    health:
      show-details: when-authorized
  info:
    build:
      enabled: true

logging:
  level:
    root: INFO
    # Log routing decisions and predicate matching from the MVC Gateway
    org.springframework.cloud.gateway.server.mvc: DEBUG
    # Log overall request processing in the MVC dispatcher
    org.springframework.web.servlet.DispatcherServlet: DEBUG
    # Log 404 Not Found errors clearly
    org.springframework.web.servlet.PageNotFound: INFO
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [%X{requestId}] - %msg%n'

app:
  cors:
    allowed-origins: ${ALLOWED_ORIGINS:http://127.0.0.1:3000}
    allowed-methods: GET,POST,PUT,DELETE
    allowed-headers: Authorization,Content-Type,X-Requested-With,Accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers,Access-Control-Allow-Origin
